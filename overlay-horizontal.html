<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Beats &amp; Bourbon &mdash; Horizontal Overlay</title>
<link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:wght@400;700;900&family=Playfair+Display:ital@1&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --gold: #D4A843;
    --gold-light: #F4C430;
    --dark-bg: #0D0B08;
    --cream: #F5F0E8;
    --border: rgba(212,168,67,0.5);
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'DM Sans', sans-serif;
    background: transparent;
    overflow: hidden;
  }
  .overlay {
    display: flex;
    align-items: center;
    background: var(--dark-bg);
    border-top: 2px solid var(--gold);
    padding: 10px 28px;
    min-height: 110px;
    position: relative;
  }
  .overlay::after {
    content: '';
    position: absolute;
    top: 2px; left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(212,168,67,0.3), transparent);
  }
  /* Brand emblem */
  .brand {
    display: flex;
    align-items: center;
    gap: 14px;
    margin-right: 24px;
    flex-shrink: 0;
  }
  .emblem-ring {
    width: 56px;
    height: 56px;
    border: 1.5px solid var(--gold);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    flex-shrink: 0;
  }
  .emblem-ring::before {
    content: '';
    position: absolute;
    width: calc(100% + 10px);
    height: calc(100% + 10px);
    border: 1px solid rgba(212,168,67,0.15);
    border-radius: 50%;
  }
  .emblem-text {
    font-family: 'Bodoni Moda', serif;
    color: var(--cream);
    text-align: center;
    line-height: 1.15;
    letter-spacing: 1.5px;
    font-weight: 700;
    font-size: 7px;
  }
  .e-amp {
    color: var(--gold);
    font-family: 'Playfair Display', serif;
    font-style: italic;
    letter-spacing: 0;
    font-size: 0.85em;
  }
  .brand-info {
    display: flex;
    flex-direction: column;
  }
  .brand-name {
    font-family: 'Bodoni Moda', serif;
    font-size: 18px;
    font-weight: 900;
    color: var(--cream);
    letter-spacing: 1.5px;
    line-height: 1.1;
  }
  .brand-name .amp {
    font-family: 'Playfair Display', serif;
    font-style: italic;
    color: var(--gold);
    font-size: 0.75em;
  }
  .brand-tagline {
    font-family: 'DM Sans', sans-serif;
    font-size: 10px;
    color: rgba(212,168,67,0.5);
    letter-spacing: 2px;
    text-transform: uppercase;
    font-weight: 600;
    margin-top: 2px;
  }
  /* Divider */
  .divider {
    width: 1px;
    height: 60px;
    background: linear-gradient(180deg, transparent, var(--gold), transparent);
    margin-right: 20px;
    flex-shrink: 0;
  }
  /* Slots */
  .slots {
    display: flex;
    gap: 8px;
    flex: 1;
    align-items: center;
    justify-content: space-evenly;
  }
  .slot {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    padding: 8px 12px;
    border-radius: 4px;
    flex: 1;
    max-width: 240px;
    border-bottom: 2px solid transparent;
  }
  .slot.locked {
    border-bottom-color: var(--gold);
  }
  .slot.unfilled {
    opacity: 0.3;
  }
  .slot.live {
    background: rgba(212,168,67,0.1);
    border: 1px solid var(--gold);
    border-bottom: 2px solid var(--gold);
  }
  .time {
    font-family: 'DM Sans', sans-serif;
    font-size: 12px;
    font-weight: 600;
    letter-spacing: 1px;
    color: rgba(245,240,232,0.5);
    text-transform: uppercase;
  }
  .dj-name {
    font-family: 'Bodoni Moda', serif;
    font-size: 20px;
    font-weight: 700;
    color: var(--gold);
    white-space: nowrap;
  }
  .dj-name.open {
    color: rgba(245,240,232,0.12);
    font-style: italic;
    font-weight: 400;
    font-size: 16px;
  }
  .live-badge {
    background: #C0392B;
    color: #FFF;
    font-family: 'DM Sans', sans-serif;
    font-size: 10px;
    font-weight: 700;
    padding: 2px 8px;
    border-radius: 3px;
    letter-spacing: 1.5px;
    animation: pulse 2s infinite;
  }
  @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
  .loading { color: rgba(245,240,232,0.3); font-size: 16px; padding: 10px; font-style: italic; }
  .error { color: #C0392B; font-size: 16px; padding: 10px; }
</style>
</head>
<body>
<div class="overlay" id="overlay">
  <div class="brand">
    <div class="emblem-ring">
      <div class="emblem-text">BEATS<br><span class="e-amp">&amp;</span><br>BOURBON</div>
    </div>
    <div class="brand-info">
      <div class="brand-name">BEATS <span class="amp">&amp;</span> BOURBON</div>
      <div class="brand-tagline">Premium Saturday Sounds</div>
    </div>
  </div>
  <div class="divider"></div>
  <div class="slots" id="slots">
    <div class="loading">Loading schedule...</div>
  </div>
</div>

<script>
var GAS_URL = 'https://script.google.com/macros/s/AKfycbwBkmIae1QyhVvCvGJbTMWieKmgjYuS5-cODwJvDpFhVsv9lunxTnRYdVuX43m5LIOV/exec';

function getET() {
  var s = new Date().toLocaleString('en-US', { timeZone: 'America/New_York' });
  return new Date(s);
}

function parseHour(t) {
  var m = t.match(/(\d{1,2})(?::00)?\s*(AM|PM)/i);
  if (!m) return -1;
  var h = parseInt(m[1]), ap = m[2].toUpperCase();
  if (ap === 'PM' && h !== 12) h += 12;
  if (ap === 'AM' && h === 12) h = 0;
  return h;
}

function shortTime(t) {
  var parts = t.split(/\s*[-\u2013]\s*/);
  if (parts.length !== 2) return t;
  var startMatch = parts[0].match(/(\d{1,2})(?::00)?\s*(AM|PM)/i);
  var endMatch = parts[1].match(/(\d{1,2})(?::00)?\s*(AM|PM)/i);
  if (!startMatch || !endMatch) return t;
  var sAP = startMatch[2].toUpperCase(), eAP = endMatch[2].toUpperCase();
  if (sAP === eAP) return startMatch[1] + '\u2013' + endMatch[1] + ' ' + eAP;
  return startMatch[1] + ' ' + sAP + '\u2013' + endMatch[1] + ' ' + eAP;
}

function cleanDJName(name) {
  return name.replace(/\s*\(Anchor\)/i, '');
}

function escapeHTML(str) {
  var div = document.createElement('div');
  div.appendChild(document.createTextNode(str));
  return div.innerHTML;
}

function renderSchedule(data) {
  var slotsEl = document.getElementById('slots');
  var schedule = data.schedule || [];
  if (schedule.length === 0) {
    slotsEl.innerHTML = '<div class="loading">No schedule available</div>';
    return;
  }

  var et = getET();
  var currentDay = et.getDay();
  var currentHour = et.getHours();
  var html = '';

  for (var i = 0; i < schedule.length; i++) {
    var s = schedule[i];
    var djDisplay = s.dj ? cleanDJName(s.dj) : '';
    var isOpen = !s.dj || s.status === 'UNFILLED';
    var statusClass = '';
    if (s.status === 'LOCKED') statusClass = ' locked';
    else if (isOpen) statusClass = ' unfilled';

    var isLive = false;
    if (currentDay === 6) {
      var slotStart = parseHour(s.timeSlot);
      if (slotStart >= 0 && currentHour >= slotStart && currentHour < slotStart + 2) {
        isLive = true;
        statusClass = ' live';
      }
    }

    html += '<div class="slot' + statusClass + '">';
    html += '<div class="time">' + escapeHTML(shortTime(s.timeSlot)) + '</div>';
    if (isOpen) {
      html += '<div class="dj-name open">Open</div>';
    } else {
      html += '<div class="dj-name">' + escapeHTML(djDisplay);
      if (isLive) html += ' <span class="live-badge">LIVE</span>';
      html += '</div>';
    }
    html += '</div>';
  }

  slotsEl.innerHTML = html;
}

function fetchSchedule() {
  fetch(GAS_URL + '?action=getSchedule')
    .then(function(res) { return res.json(); })
    .then(function(data) { renderSchedule(data); })
    .catch(function(err) {
      console.error('Fetch error:', err);
      loadViaJSONP();
    });
}

function loadViaJSONP() {
  var callbackName = '_bbScheduleCb_' + Date.now();
  window[callbackName] = function(data) {
    renderSchedule(data);
    delete window[callbackName];
    var script = document.getElementById('jsonp-schedule');
    if (script) script.remove();
  };
  var s = document.createElement('script');
  s.id = 'jsonp-schedule';
  s.src = GAS_URL + '?action=getSchedule&callback=' + callbackName;
  s.onerror = function() {
    document.getElementById('slots').innerHTML = '<div class="error">Unable to load schedule</div>';
  };
  document.head.appendChild(s);
}

fetchSchedule();
setInterval(fetchSchedule, 60000);
</script>
</body>
</html>
